@using Newtonsoft.Json
@model hakathon.Models.tblUserProfiles

<div class="sensy-profile-header">
    <h1 class="sensy-profile-title">Trang cá nhân</h1>
</div>


    <div class="sensy-profile-wrapper">
        <!-- Sidebar navigation -->
        <div class="sensy-profile-sidebar">
            <div class="sensy-profile-user-info">
                <div class="sensy-profile-avatar">
                    <img src="/api/placeholder/150/150" alt="Avatar người dùng" id="sensy-user-avatar">
                    <div class="sensy-profile-avatar-edit">
                        <label for="sensy-avatar-upload">
                            <i class="sensy-icon-camera"></i>
                        </label>
                        <input type="file" id="sensy-avatar-upload" accept="image/*" style="display: none;">
                    </div>
                </div>
            @if (Model != null)
            {
                <h2 class="sensy-profile-name" id="sensy-user-name">@Model.FullName</h2>
                <p class="sensy-profile-email" id="sensy-user-email">@User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value</p>
            }
               
            </div>
            <ul class="sensy-profile-nav">
                <li class="sensy-profile-nav-item active" data-tab="sensy-personal-info">
                    <i class="sensy-icon-user"></i> Thông tin cá nhân
                </li>
                <li class="sensy-profile-nav-item" data-tab="sensy-change-password">
                    <i class="sensy-icon-lock"></i> Đổi mật khẩu
                </li>
                <li class="sensy-profile-nav-item" data-tab="sensy-activity-history">
                    <i class="sensy-icon-history"></i> Lịch sử hoạt động
                </li>
            </ul>
        </div>

    
        <!-- Content area -->
        <div class="sensy-profile-content">
            <!-- Thông tin cá nhân tab -->
        @if (Model == null)
        {
            <div class="alert alert-danger">
                <strong>Thông báo:</strong> Bạn chưa cập nhật hồ sơ cá nhân.
            </div>

            <a class="btn btn-primary"
               asp-controller="Profile"
               asp-action="Create"
               asp-route-userId="@User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value">
                Cập nhật hồ sơ ngay
            </a>
        }
        else
        {
            <div class="sensy-profile-tab active" id="sensy-personal-info">
                <div class="sensy-profile-section">
                    <h3 class="sensy-profile-section-title">Thông tin cá nhân</h3>
                    <form id="profileForm" class="sensy-profile-form" asp-action="Edit" asp-controller="Profile" method="post">
                        <div class="sensy-form-group">
                            <label asp-for="FullName">Họ và tên</label>
                            <input type="text" class="sensy-form-control" asp-for="FullName" />
                        </div>

                        <div class="sensy-form-group">
                            <label asp-for="Bio">Tiểu sử</label>
                            <input type="text" class="sensy-form-control" asp-for="Bio" />
                        </div>

                        <div class="sensy-form-group">
                            <label asp-for="Phone">Số điện thoại</label>
                            <input type="tel" class="sensy-form-control" asp-for="Phone" />
                        </div>

                        <div class="sensy-form-group">
                            <label asp-for="DateOfBirth">Ngày sinh</label>
                            <input type="date" class="sensy-form-control" asp-for="DateOfBirth" />
                        </div>

                        <div class="sensy-form-group">
                            <label asp-for="Address">Địa chỉ</label>
                            <input type="text" class="sensy-form-control" asp-for="Address" />
                        </div>

                        @if (!string.IsNullOrEmpty(Model.ProfilePicture))
                        {
                            <div class="sensy-form-actions">
                                <img src="@Url.Content(Model.ProfilePicture)" alt="Ảnh đại diện" style="max-width:150px;" />
                            </div>
                        }

                        <div class="sensy-form-group">
                            <button id="submitBtn" type="submit" class="sensy-btn sensy-btn-primary">Lưu thay đổi</button>
                        </div>
                    </form>
                </div>
            </div>
            }

        <div class="sensy-profile-tab" id="sensy-change-password">
            <div class="sensy-profile-section">
                <h3 class="sensy-profile-section-title">Đổi mật khẩu</h3>

                @{
                    hakathon.Models.ChangePasswordViewModel changePassModel = new hakathon.Models.ChangePasswordViewModel();

                    if (TempData["ChangePasswordModel"] != null)
                    {
                        var json = TempData["ChangePasswordModel"].ToString();
                        changePassModel = JsonConvert.DeserializeObject<hakathon.Models.ChangePasswordViewModel>(json);
                    }
                }

                @await Html.PartialAsync("~/Views/Profile/ChangePassword.cshtml", changePassModel)


            </div>
        </div>


            <!-- Lịch sử hoạt động tab -->
            <div class="sensy-profile-tab" id="sensy-activity-history">
                <div class="sensy-profile-section">
                    <h3 class="sensy-profile-section-title">Lịch sử hoạt động</h3>

                    <!-- Tab navigation for activity history -->
                    <div class="sensy-activity-tabs">
                        <button class="sensy-activity-tab active" data-activity="sensy-viewed">Đã xem</button>
                        <button class="sensy-activity-tab" data-activity="sensy-downloaded">Đã tải xuống</button>
                        <button class="sensy-activity-tab" data-activity="sensy-rated">Đã đánh giá</button>
                        <button class="sensy-activity-tab" data-activity="sensy-comments">Bình luận</button>
                    </div>

                    <!-- Viewed documents -->
                    <div class="sensy-activity-content active" id="sensy-viewed">
                        <div class="sensy-activity-list">
                            <!-- Sample viewed document items -->
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Tài liệu về Kinh tế vĩ mô</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã xem lúc: 12/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem lại</a>
                                </div>
                            </div>
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Hướng dẫn sử dụng Excel nâng cao</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã xem lúc: 10/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem lại</a>
                                </div>
                            </div>
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Báo cáo thị trường 2025</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã xem lúc: 05/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem lại</a>
                                </div>
                            </div>
                        </div>
                        <div class="sensy-pagination">
                            <button class="sensy-pagination-prev">Trước</button>
                            <span class="sensy-pagination-info">Trang 1/3</span>
                            <button class="sensy-pagination-next">Sau</button>
                        </div>
                    </div>

                    <!-- Downloaded documents -->
                    <div class="sensy-activity-content" id="sensy-downloaded">
                        <div class="sensy-activity-list">
                            <!-- Sample downloaded document items -->
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Báo cáo tài chính Q1 2025</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã tải lúc: 11/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Tải lại</a>
                                </div>
                            </div>
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Sổ tay hướng dẫn quản lý</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã tải lúc: 09/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Tải lại</a>
                                </div>
                            </div>
                        </div>
                        <div class="sensy-pagination">
                            <button class="sensy-pagination-prev">Trước</button>
                            <span class="sensy-pagination-info">Trang 1/1</span>
                            <button class="sensy-pagination-next" disabled>Sau</button>
                        </div>
                    </div>

                    <!-- Rated documents -->
                    <div class="sensy-activity-content" id="sensy-rated">
                        <div class="sensy-activity-list">
                            <!-- Sample rated document items -->
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Công nghệ thông tin 2025</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-rating">
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star"></i>
                                        </span>
                                        <span class="sensy-activity-date">Đã đánh giá lúc: 08/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem tài liệu</a>
                                </div>
                            </div>
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Sách hướng dẫn lập trình Python</a></h4>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-rating">
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star active"></i>
                                            <i class="sensy-icon-star"></i>
                                            <i class="sensy-icon-star"></i>
                                        </span>
                                        <span class="sensy-activity-date">Đã đánh giá lúc: 04/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem tài liệu</a>
                                </div>
                            </div>
                        </div>
                        <div class="sensy-pagination">
                            <button class="sensy-pagination-prev">Trước</button>
                            <span class="sensy-pagination-info">Trang 1/1</span>
                            <button class="sensy-pagination-next" disabled>Sau</button>
                        </div>
                    </div>

                    <!-- Comments -->
                    <div class="sensy-activity-content" id="sensy-comments">
                        <div class="sensy-activity-list">
                            <!-- Sample comment items -->
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Hướng dẫn SEO 2025</a></h4>
                                    <p class="sensy-comment-text">"Tài liệu rất hữu ích và dễ hiểu. Cảm ơn tác giả!"</p>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã bình luận lúc: 11/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem tài liệu</a>
                                </div>
                            </div>
                            <div class="sensy-activity-item">
                                <div class="sensy-activity-info">
                                    <h4><a href="#">Chiến lược marketing online</a></h4>
                                    <p class="sensy-comment-text">"Tôi đã áp dụng các chiến lược này và thấy hiệu quả rõ rệt. Đề xuất cho mọi người cùng đọc."</p>
                                    <p class="sensy-activity-meta">
                                        <span class="sensy-activity-date">Đã bình luận lúc: 07/05/2025</span>
                                    </p>
                                </div>
                                <div class="sensy-activity-actions">
                                    <a href="#" class="sensy-btn sensy-btn-outline">Xem tài liệu</a>
                                </div>
                            </div>
                        </div>
                        <div class="sensy-pagination">
                            <button class="sensy-pagination-prev">Trước</button>
                            <span class="sensy-pagination-info">Trang 1/1</span>
                            <button class="sensy-pagination-next" disabled>Sau</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<body data-activetab="@TempData["ActiveTab"]">
    </body>
<script>
    document.getElementById('profileForm').addEventListener('submit', function () {
        
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.innerText = 'Đang lưu...';

        const inputs = this.querySelectorAll('input, textarea');
        inputs.forEach(function (el) {
            el.readOnly = true;
        });
    });

    function initProfileTabs() {
        const profileTabs = document.querySelectorAll('.sensy-profile-nav-item');
        const tabContents = document.querySelectorAll('.sensy-profile-tab');

        profileTabs.forEach(tab => {
            tab.addEventListener('click', function () {
                profileTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                tabContents.forEach(content => content.classList.remove('active'));

                const target = this.getAttribute('data-tab');
                document.getElementById(target).classList.add('active');
            });
        });

        const activeTab = document.body.getAttribute('data-activetab');
        if (activeTab) {
            const tabBtn = document.querySelector(`[data-tab="${activeTab}"]`);
            const tabContent = document.getElementById(activeTab);

            if (tabBtn && tabContent) {
                profileTabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));

                tabBtn.classList.add('active');
                tabContent.classList.add('active');
            }
        }
    }


    document.addEventListener('DOMContentLoaded', function () {
        initProfileTabs();
    });
</script>
